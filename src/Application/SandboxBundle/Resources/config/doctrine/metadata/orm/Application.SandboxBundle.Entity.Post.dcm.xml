<?xml version="1.0" encoding="utf-8"?>
<doctrine-mapping
	xmlns="http://doctrine-project.org/schemas/orm/doctrine-mapping" xsi="http://www.w3.org/2001/XMLSchema-instance"
	schemaLocation="http://doctrine-project.org/schemas/orm/doctrine-mapping http://doctrine-project.org/schemas/orm/doctrine-mapping.xsd">
	<!-- This file has been generated by the EasyExtends bundle ( http://sonata-project.org/easy-extends 
		) References : xsd : https://github.com/doctrine/doctrine2/blob/master/doctrine-mapping.xsd 
		xml mapping : http://www.doctrine-project.org/projects/orm/2.0/docs/reference/xml-mapping/en 
		association mapping : http://www.doctrine-project.org/projects/orm/2.0/docs/reference/association-mapping/en -->
	<entity name="Application\SandboxBundle\Entity\Post"
        table="post"
		repository-class="Application\SandboxBundle\Entity\PostRepository">

		<id name="id" type="integer" column="id">
			<generator strategy="AUTO" />
		</id>

		<field name="title" type="string" column="title" />
		<field name="abstract" type="text" column="abstract" />
		<field name="content" type="text" column="content" />
		<field name="enabled" type="boolean" column="enabled" default="false" />
		<field name="slug" type="string" column="slug" />
		<field name="publicationDateStart" type="datetime"
			column="publicationDateStart" nullable="true" />
		<field name="commentsEnabled" type="boolean" column="comments_enabled"
			default="true" />
		<field name="commentsCloseAt" type="datetime" column="comments_close_at"
			nullable="true" />
		<field name="commentsDefaultStatus" type="integer"
			column="comments_default_status" nullable="false" />
		<field name="createdAt" type="datetime" column="created_at" />
		<field name="updatedAt" type="datetime" column="updated_at" />

		<lifecycle-callbacks>
			<lifecycle-callback type="prePersist" method="prePersist" />
			<lifecycle-callback type="preUpdate" method="preUpdate" />
		</lifecycle-callbacks>

		<many-to-many field="tags"
			target-entity="Application\SandboxBundle\Entity\Tag" inversed-by="posts"
			fetch="EAGER">

			<cascade>
				<cascade-persist />
				<!--<cascade-merge /> -->
				<!--<cascade-remove /> -->
				<!--<cascade-refresh /> -->
			</cascade>

			<join-table name="post_tag">
				<join-columns>
					<join-column name="post_id" referenced-column-name="id" />
				</join-columns>
				<inverse-join-columns>
					<join-column name="tag_id" referenced-column-name="id" />
				</inverse-join-columns>
			</join-table>

		</many-to-many>

		<one-to-many field="comments"
			target-entity="Application\SandboxBundle\Entity\Comment" 
			mapped-by="post"
			orphan-removal="true">

			<cascade>
				<cascade-persist />
			</cascade>

			<join-columns>
				<join-column name="id" referenced-column-name="post_id" />
			</join-columns>

			<order-by>
				<order-by-field name="created_at" direction="DESC" />
			</order-by>
		</one-to-many>

	</entity>
</doctrine-mapping>